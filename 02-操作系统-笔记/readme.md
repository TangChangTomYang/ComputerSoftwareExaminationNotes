# 操作系统

操作系统在软考中有几个比较难的点. 每年有6~8分

这个章节主要停留在上午题, 选择题



考点主要体现在:

- 进程管理
  - 进程状态
  - 前趋图
  - 信号量与PV操作  (这个比较难)
  - 死锁及银行家算法
- 存储管理
  - 段页式存储
  - 页面置换算法
- 文件管理
  - 绝对路径与相对路径
  - 索引文件
  - 位士图
- 作业管理
- 设备管理
  - 虚设备与SPOOLING技术



## 1、进程管理

### 1、进程的概念

进程是程序在一个数据集合上运行的过程, 它是系统进行资源分配和调度的一个独立单位. 它由**程序块、进程块(PCB)和数据块**三部分组成. 

**进程与程序的区别:**

进程是程序的一次执行过程, 没有程序就没有进程. 程序是完成某个特定功能的一系列程序语句的集合, 只要不被破坏它就永远存在. 程序是一个静态的概念, 而进程是一个动态的概念. 它由创建而产生, 完成任务后因撤销而消失. 进程是系统进行资源分配和调度的独立单位, 而程序不是. 



### 2、进程的几种状态



#### 1、进程的三态模型

> 所谓进程的三态模型, 其实说的就是进程的三种状态的转换关系. 



- **等待状态**(阻塞状态) ----等待事件发生----> **就绪状态**

- **就绪状态** ----调度----> **运行状态**

  **运行状态** ----时间片到了----> **就绪状态**

- **运行状态** ----等待某个事件 ----> **等待状态**(阻塞状态) 

  > 有时等待状态也称为阻塞状态
  >
  > 当程序处于就绪状态时, 所需要的资源都具备了, 现在只缺的是CPU的资源, 只有CPU有空了CPU调度就成就绪状态转换为运行状态. 
  >
  > 当CPU处于运行状态时, 有可能会需要等待某些事情的发生(比如: IO设备的输入输出 , 其它线程的操作响应等)这时CPU就会进入阻塞的状态 (即 等待的状态)
  
  <img src="images/进程三态模型.png" width=300 > 
  
  从图上我们发现, 只有就绪状态和运行状态是可以相互转换的, 那么是在什么情况下就绪状态和运行状态是会相互转换的呢?
  
  >  有2种情况, 就绪状态和运行状态会发生相互转换.
  >
  > - CPU的时间片到了用完了, 此时不能再给你用, 从运行状态直接切换到就绪状态. 
  > - 第二种是进来一个优先级更高的线程, 那此时你优先级低的线程就只能回到就绪状态. 释放资源让别人先用.





#### 2、进程的五态模型

总的来说, 五态模型就是在三态模型的基础上增加了2种静止态. 静止就绪和静止阻塞

<img src="images/五态模型.png" width=400> 

>  五态模型中, 一般什么情况会从 运行态 状态称 静止就绪态呢?
>
> 在五态模型中, 一般从就绪态装换为静止就绪态都是认为的操作, 比如: 我们听音乐的过程中,认为的点击暂停按钮. 这是 就从运行态  切换到了 静止就绪态

因为三态模型相对于来说比较简单, 后面就出现了5态模型, 7态模型, 9态模型. 

在 软考中, 重点掌握三态模型





### 3、进程的同步与互斥

<img src="images/同步与互斥.png"> 



- **什么是同步?**

  同步就是合作进程之间直接的制约关系. 

  > 比如, 上图中要求张三和李四同时到达终点, 但是张三和李四的速度不一样,这就要求李四等着张三,  这样他们之间就有一个直接的制约关系 ,  这就称为同步.  
  >
  > 简单的说, 同步就是执行的快的等执行的慢的, 最后一起把事情做完

- **什么事互斥呢?**

  互斥就是多个或一个进程之间形成的间接制约关系. 这个间接的制约关系是因为他们要去争夺临界资源.  比如上图中的独木桥就是临界资源, 只要有一个人在独木桥上, 那么千军万马也要等着,  这就间接的形成了制约关系, 我占了你就不能占, 这就是互斥. 



### 4、PV操作

#### 1、PV操作介绍



> 其实PV操作就是我们常见的一种信号量加锁.

在我们进程管理当中, PV操作就是我们对于临界资源共享的处理 方式.在PV操作中有几个名词大家可以了解下:  **临界资源、临界区、信号量**

- **临界资源(⭐️):**

  诸进程间需要**互斥方式**对其进行共享资源, 如果: 打印机、磁带等

- **临界区:**

  每个进程中访问临界资源的那段代码称为临界区.

- **信号量:**

  是一种特殊的变量, 可以为正数也可以为负数, 当为负数时表示队列中有任务处于等待(阻塞)状态. 

  

**P**是荷兰语的**Passeren** (表示通过的意思), **V** 是荷兰语的**Verhoog**(表示释放的意思)

PV操作是成对出现的, 有申请就有释放. 

<img src="images/PV操作.png" width=400> 

总的来讲, PV操作就是一种具体的临界资源共享的方式, 

对于P操作, **它是一个申请资源的操作.**

对于V操作, **它是一种释放资源的操作** .  

对于上图中的S, 表示的就是**信号量, 代表临界资源的总数**

>  **详解P操作(申请资源)的过程:**
>
> 当我们进行P操作(即, 申请资源)时,  **资源数s就会减少1**, s这个信号量代表的就是临界资源的总数, 当**S小于0时表示当前没有资源可分配了,** 程序就需要挂起, 这个时候其它的事情就会停下来进入阻塞状态.  如果信号量s分配后**大于等于0表示分配的资源还有**, 这个时候就可以继续执行. 
>
> **详解V操作(释放资源)的过程:**
>
> 相对于P操作来说V操作是一个释放资源的操作, 当释放资源的时候**信号量S会执行加1操作**,代表回收释放了一个资源, 然后会判断**信号量s是否小于等于0**, 如果小于等于0说明阻塞队列里面还**有任务处于阻塞状态在等待执行**, 这时我们就要**唤醒队列中处于等待(阻塞)的任务**, 现在有一个资源释放了你可以申请资源了, 如果资源释放后发现**S的值>0 说明阻塞队列里面是空的,** 这时直接做事情即可不需要做任何唤醒操作. 

这个PV操作把信号量讲的很清楚, 仔细思考其中的流程细节, 对写代码有帮助. 



#### 2、PV操作-互斥模型

**PV互斥模型的典型例子就是, 多个进程共享一台打印机(互斥模型)的情景, 同一时间只能有一个人使用设备.** 



- **P(s) 申请资源, 信号量S=S-1**, 当S<0时挂起(阻塞等待), 否则立即执行

- **V(s) 释放资源, 信号量S=S+1**, 当S<=0时队列有阻塞需要唤醒执行, 否则正常执行

<img src="images/PV互斥.png" width=250> 

互斥模型对于多进程来说它是因为争夺临界资源(打印机等), 一般情况下临界资源都是有限的都需要争夺. 

> 我们讲一个理发店的例子来说明:
>
> 理发店中只有一个师傅, 最开始的时候信号量S=1,  来了一个客人A1理发P(s)申请一个资源,  信号量S=S-1=0,  如果此时再来一个客人A2理发P(s)再申请一个资源, 信号量S=S-1 = -1这时A2挂起进入阻塞, 这时只有等到A1完成操作, 师傅释放资源V(s), 此时 S=S+1=0 唤醒A2, 然后A2 就可以执行后续操作了. 



PV操作是成对出现的, 有申请就有释放 



#### 3、PV操作-同步模型

**PV同步模型, 典型的例子就是单缓冲区生产者、消费者问题**

<img src="images/PV同步.png" width=400>  

PV 的同步模型比PV的互斥模型要复杂有点. 上图中,我们介绍的PV同步模型, 是基于单缓冲区来说明的. 

> 什么是单换冲区呢? 
>
> 简单的讲, 单缓冲区就是指一次只有一个进程在那里执行. 

在介绍PV同步模型前, 我们先来了解下这里面的角色:

- 生产者

  生产者的任务就是负责生产

- 消费者

  消费者的任务就是负责消费

- 市场

  市场是用来存放产品的(可以理解为仓库的概念)





